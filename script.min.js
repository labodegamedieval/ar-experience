window.checkLocationManual=function(){const e=document.getElementById("location-input");if(!e)return;const t=e.value.trim().toLowerCase(),n=["castillo","plaza","iglesia","fuente","ermita","puente","puente-tablas","bodega","humilladero","arco","callejon","escortinas"];n.includes(t)?(setStatus("âœ… ConfirmaciÃ³n manual aceptada."),unlockContent(t)):setStatus("âŒ Ese no es el nombre correcto. Elige entre las opciones propuestas.")},window.checkLocation=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{const t=getCurrentStop(),n=locations[t],o=getDistanceFromLatLonInMeters(e.coords.latitude,e.coords.longitude,n.lat,n.lng);o<=25?(setStatus("âœ… UbicaciÃ³n verificada."),unlockContent()):setStatus(`ðŸ“ EstÃ¡s a ${Math.round(o)} m del lugar. AcÃ©rcate.`)},()=>{setStatus("âš ï¸ Error al obtener tu posiciÃ³n.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):setStatus("âš ï¸ GeolocalizaciÃ³n no disponible.")},window.checkQR=function(){const e=document.getElementById("qr-input"),t=document.getElementById("qr-status"),n=e.value.trim().toUpperCase(),o={"CASTILLO-1834":"castillo","PLAZA-1523":"plaza","IGLESIA-1300":"iglesia","FUENTE-1600":"fuente","ERMITA-1500":"ermita","PUENTE-1400":"puente","BODEGA-1600":"bodega","HUMILLADERO-1512":"humilladero","TABLAS-001":"puente-tablas","ARCO-1420":"arco","CALLEJON-1444":"callejon","ESCORTINAS-1555":"escortinas"};o[n]?(t.textContent="âœ… QR correcto. Parada desbloqueada.",localStorage.setItem(`${o[n]}-discovered`,"true"),setTimeout(()=>{window.location.href=o[n]+".html"},1500)):t.textContent="âŒ CÃ³digo incorrecto."},window.checkVisualAnswer=function(e,t,n){const o=document.getElementById(`visual-resultado-${n}`);e===t?(o.textContent="âœ… Â¡Correcto!",o.style.color="green",playSound("coins-sound")):(o.textContent="âŒ Incorrecto.",o.style.color="darkred",playSound("error-sound"))},window.checkAnswer=function(e,t,n){const o=document.getElementById(`quiz-resultado-${n}`);e===t?(o.textContent="âœ… Â¡Correcto!",o.style.color="green",playSound("cheers-sound")):(o.textContent="âŒ Incorrecto.",o.style.color="darkred",playSound("error-sound"))},window.showHint=function(e){alert(`ðŸ’¡ Pista: ${e}`)},document.addEventListener("DOMContentLoaded",()=>{let e=!0;const t=document.getElementById("background-music"),n=document.querySelector(".music-btn"),o=document.querySelector(".music-icon");n&&n.addEventListener("click",()=>{e?(t.pause(),o.textContent="ðŸ”‡"):(t.play().catch(()=>{}),o.textContent="ðŸŽµ"),e=!e});const c=document.querySelectorAll(".slide");let r=0;function a(e){c.forEach((t,n)=>t.classList.toggle("active",n===e))}document.querySelector(".prev-slide")&&document.querySelector(".prev-slide").addEventListener("click",()=>{r=r>0?r-1:c.length-1,a(r)}),document.querySelector(".next-slide")&&document.querySelector(".next-slide").addEventListener("click",()=>{r=r<c.length-1?r+1:0,a(r)}),a(r)});const locations={castillo:{lat:40.520512,lng:-6.063541},plaza:{lat:40.520621,lng:-6.063455},iglesia:{lat:40.521379,lng:-6.06381},fuente:{lat:40.522185,lng:-6.064564},ermita:{lat:40.522793,lng:-6.066424},puente:{lat:40.522552,lng:-6.065858},"puente-tablas":{lat:40.5245,lng:-6.0672},humilladero:{lat:40.5232,lng:-6.0667},arco:{lat:40.5218,lng:-6.063},callejon:{lat:40.5219,lng:-6.0633},escortinas:{lat:40.5236,lng:-6.0649}};function unlockContent(e=null){const t=document.getElementById("game-content"),n=document.getElementById("location-check");t&&(t.style.display="block"),n&&(n.style.display="none");const o=e||getCurrentStop();o&&localStorage.setItem(`${o}-completed`,"true"),playSound("success-sound")}function setStatus(e){const t=document.getElementById("location-status");t&&(t.textContent=e)}function getCurrentStop(){return window.location.pathname.split("/").pop().replace(".html","")}function getDistanceFromLatLonInMeters(e,t,n,o){const c=6371000,r=(n-e)*Math.PI/180,a=(o-t)*Math.PI/180,u=Math.sin(r/2)**2+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(a/2)**2,l=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return c*l}function playSound(e){const t=document.getElementById(e);t&&(t.currentTime=0,t.play().catch(()=>{}))}
